<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>compiler::Case</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>compiler</a></li>
  <li>&gt;</li>
  <li><a href='Case.html'>Case</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
<div class='overview'>
<h2>class</h2>
<h1>compiler::Case</h1>
<pre><a href='../sys/Obj.html'>sys::Obj</a>
  <a href='Node.html'>compiler::Node</a>
    compiler::Case</pre>
</div>
</div>
<div class='src'>
<pre>
<span class='y'>//</span>
<span class='y'>// Copyright (c) 2006, Brian Frank and Andy Frank</span>
<span class='y'>// Licensed under the Academic Free License version 3.0</span>
<span class='y'>//</span>
<span class='y'>// History:</span>
<span class='y'>//   19 Jul 06  Brian Frank  Creation</span>
<span class='y'>//</span>

<span class='z'>**</span>
<span class='z'>** Stmt</span>
<span class='z'>**</span>
<span class='k'>abstract</span> <span class='k'>class</span> Stmt : Node
<span class='b'>{</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Construction</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='k'>new</span> make<span class='b'>(</span>Loc loc, StmtId id<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.id = id
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Stmt</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Does this statement always cause us to exit the method (or does it</span>
  <span class='z'>** cause us to loop forever without a break to the next statement)</span>
  <span class='z'>**</span>
  <span class='k'>abstract</span> Bool isExit<span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Check for definite assignment where the given function</span>
  <span class='z'>** returns true for the LHS of an assignment in all code paths.</span>
  <span class='z'>**</span>
  <span class='k'>abstract</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Tree</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  Stmt<span class='b'>[]</span>? walk<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    v.enterStmt<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    walkChildren<span class='b'>(</span>v, depth<span class='b'>)</span>
    r := v.visitStmt<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    v.exitStmt<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    <span class='k'>return</span> r
  <span class='b'>}</span>

  <span class='k'>virtual</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
  <span class='b'>}</span>

  <span class='k'>static</span> Expr? walkExpr<span class='b'>(</span>Visitor v, VisitDepth depth, Expr? expr<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>depth === VisitDepth.expr &amp;&amp; expr != <span class='k'>null</span><span class='b'>)</span>
      <span class='k'>return</span> expr.walk<span class='b'>(</span>v<span class='b'>)</span>
    <span class='k'>else</span>
      <span class='k'>return</span> expr
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Fields</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='k'>readonly</span> StmtId id

<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** NopStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** NopStmt is no operation do nothing statement.</span>
<span class='z'>**</span>
<span class='k'>class</span> NopStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.nop<span class='b'>)</span> <span class='b'>{}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"nop"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** ExprStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** ExprStmt is a statement with a stand along expression such</span>
<span class='z'>** as an assignment or method call.</span>
<span class='z'>**</span>
<span class='k'>class</span> ExprStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Expr expr<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>expr.loc, StmtId.expr<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.expr = expr
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span> <span class='b'>{</span> expr.isDefiniteAssign<span class='b'>(</span>f<span class='b'>)</span> <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    expr = walkExpr<span class='b'>(</span>v, depth, expr<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Str toStr<span class='b'>()</span> <span class='b'>{</span> expr.toStr <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    printOpt<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>

  Void printOpt<span class='b'>(</span>AstWriter out, Bool nl := <span class='k'>true</span><span class='b'>)</span>
  <span class='b'>{</span>
    expr.print<span class='b'>(</span>out<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>nl<span class='b'>)</span> out.nl
  <span class='b'>}</span>

  Expr expr
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** LocalDefStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** LocalDefStmt models a local variable declaration and its</span>
<span class='z'>** optional initialization expression.</span>
<span class='z'>**</span>
<span class='k'>class</span> LocalDefStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc, CType? ctype := <span class='k'>null</span>, Str name := <span class='s'>""</span><span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.localDef<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.ctype = ctype
    <span class='k'>this</span>.name = name
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    init = walkExpr<span class='b'>(</span>v, depth, init<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>new</span> makeCatchVar<span class='b'>(</span>Catch c<span class='b'>)</span>
    : <span class='k'>super</span>.make<span class='b'>(</span>c.loc, StmtId.localDef<span class='b'>)</span>
  <span class='b'>{</span>
    ctype = c.errType
    name  = c.errVariable
    isCatchVar = <span class='k'>true</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Str toStr<span class='b'>()</span> <span class='b'>{</span> <span class='s'>"$ctype $name ($var)"</span> <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span> <span class='b'>{</span> printOpt<span class='b'>(</span>out<span class='b'>)</span> <span class='b'>}</span>

  Void printOpt<span class='b'>(</span>AstWriter out, Bool nl := <span class='k'>true</span><span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>ctype != <span class='k'>null</span><span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>"$ctype "</span><span class='b'>)</span>
    out.w<span class='b'>(</span>name<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>init != <span class='k'>null</span><span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>" init: $init"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>nl<span class='b'>)</span> out.nl
  <span class='b'>}</span>

  CType? ctype      <span class='y'>// type of the variable (or null if inferred)</span>
  Str name          <span class='y'>// variable name</span>
  Expr? init        <span class='y'>// rhs of init; in ResolveExpr it becomes full assign expr</span>
  Bool isCatchVar   <span class='y'>// is this auto-generated var for "catch (Err x)"</span>
  MethodVar? var    <span class='y'>// variable binding</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** IfStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** IfStmt models an if or if/else statement.</span>
<span class='z'>**</span>
<span class='k'>class</span> IfStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc, Expr condition, Block trueBlock<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.ifStmt<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.condition = condition
    <span class='k'>this</span>.trueBlock = trueBlock
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>falseBlock == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> trueBlock.isExit &amp;&amp; falseBlock.isExit
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>!trueBlock.isDefiniteAssign<span class='b'>(</span>f<span class='b'>))</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>if</span> <span class='b'>(</span>condition.id === ExprId.trueLiteral<span class='b'>)</span> <span class='k'>return</span> <span class='k'>true</span>
    <span class='k'>if</span> <span class='b'>(</span>falseBlock == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> falseBlock.isDefiniteAssign<span class='b'>(</span>f<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    condition = walkExpr<span class='b'>(</span>v, depth, condition<span class='b'>)</span>
    trueBlock.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>falseBlock != <span class='k'>null</span><span class='b'>)</span> falseBlock.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"if ($condition)"</span><span class='b'>)</span>.nl
    trueBlock.print<span class='b'>(</span>out<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>falseBlock != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      out.w<span class='b'>(</span><span class='s'>"else"</span><span class='b'>)</span>.nl
      falseBlock.print<span class='b'>(</span>out<span class='b'>)</span>
    <span class='b'>}</span>
  <span class='b'>}</span>

  Expr condition      <span class='y'>// test expression</span>
  Block trueBlock     <span class='y'>// block to execute if condition true</span>
  Block? falseBlock   <span class='y'>// else clause or null</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** ReturnStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** ReturnStmt returns from the method</span>
<span class='z'>**</span>
<span class='k'>class</span> ReturnStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc, Expr? expr := <span class='k'>null</span><span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.returnStmt<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.expr = expr
  <span class='b'>}</span>

  <span class='k'>new</span> makeSynthetic<span class='b'>(</span>Loc loc, Expr? expr := <span class='k'>null</span><span class='b'>)</span>
    : <span class='k'>this</span>.make<span class='b'>(</span>loc, expr<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.isSynthetic = <span class='k'>true</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> <span class='k'>true</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>expr == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> expr.isDefiniteAssign<span class='b'>(</span>f<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    expr = walkExpr<span class='b'>(</span>v, depth, expr<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Str toStr<span class='b'>()</span> <span class='b'>{</span> expr != <span class='k'>null</span> ? <span class='s'>"return $expr"</span> : <span class='s'>"return"</span> <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"return"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>expr != <span class='k'>null</span><span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>" $expr"</span><span class='b'>)</span>
    out.nl
  <span class='b'>}</span>


  Expr? expr           <span class='y'>// expr to return of null if void return</span>
  MethodVar? leaveVar  <span class='y'>// to stash result for leave from protected region</span>
  Bool isSynthetic     <span class='y'>// was return inserted by compiler</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** ThrowStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** ThrowStmt throws an exception</span>
<span class='z'>**</span>
<span class='k'>class</span> ThrowStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc, Expr exception<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.throwStmt<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.exception = exception
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>true</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    exception = walkExpr<span class='b'>(</span>v, depth, exception<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"throw $exception"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>

  Expr exception   <span class='y'>// exception to throw</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** ForStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** ForStmt models a for loop of the format:</span>
<span class='z'>**   for (init; condition; update) block</span>
<span class='z'>**</span>
<span class='k'>class</span> ForStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.forStmt<span class='b'>)</span> <span class='b'>{}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>condition.isDefiniteAssign<span class='b'>(</span>f<span class='b'>))</span> <span class='k'>return</span> <span class='k'>true</span>
    <span class='k'>if</span> <span class='b'>(</span>init != <span class='k'>null</span> &amp;&amp; init.isDefiniteAssign<span class='b'>(</span>f<span class='b'>))</span> <span class='k'>return</span> <span class='k'>true</span>
    <span class='k'>return</span> <span class='k'>false</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>init != <span class='k'>null</span><span class='b'>)</span> init.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
    condition = walkExpr<span class='b'>(</span>v, depth, condition<span class='b'>)</span>
    update = walkExpr<span class='b'>(</span>v, depth, update<span class='b'>)</span>
    block.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"for ("</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>init != <span class='k'>null</span><span class='b'>)</span> init-&gt;printOpt<span class='b'>(</span>out, <span class='k'>false</span><span class='b'>)</span>
    out.w<span class='b'>(</span><span class='s'>"; "</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>condition != <span class='k'>null</span><span class='b'>)</span> condition.print<span class='b'>(</span>out<span class='b'>)</span>
    out.w<span class='b'>(</span><span class='s'>"; "</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>update != <span class='k'>null</span><span class='b'>)</span> update.print<span class='b'>(</span>out<span class='b'>)</span>
    out.w<span class='b'>(</span><span class='s'>")"</span><span class='b'>)</span>.nl
    block.print<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>

  Stmt? init        <span class='y'>// loop initialization</span>
  Expr? condition   <span class='y'>// loop condition</span>
  Expr? update      <span class='y'>// loop update</span>
  Block? block      <span class='y'>// code to run inside loop</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** WhileStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** WhileStmt models a while loop of the format:</span>
<span class='z'>**   while (condition) block</span>
<span class='z'>**</span>
<span class='k'>class</span> WhileStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc, Expr condition, Block block<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.whileStmt<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.condition = condition
    <span class='k'>this</span>.block = block
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>
  <span class='b'>{</span>
    condition.isDefiniteAssign<span class='b'>(</span>f<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    condition = walkExpr<span class='b'>(</span>v, depth, condition<span class='b'>)</span>
    block.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"while ($condition)"</span><span class='b'>)</span>.nl
    block.print<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>

  Expr condition     <span class='y'>// loop condition</span>
  Block block        <span class='y'>// code to run inside loop</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** BreakStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** BreakStmt breaks out of a while/for loop.</span>
<span class='z'>**</span>
<span class='k'>class</span> BreakStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.breakStmt<span class='b'>)</span> <span class='b'>{}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"break"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>

  Stmt? loop   <span class='y'>// loop to break out of</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** ContinueStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** ContinueStmt continues a while/for loop.</span>
<span class='z'>**</span>
<span class='k'>class</span> ContinueStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.continueStmt<span class='b'>)</span> <span class='b'>{}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span> <span class='b'>{</span> <span class='k'>false</span> <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"continue"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>

  Stmt? loop   <span class='y'>// loop to continue</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** TryStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** TryStmt models a try/catch/finally block</span>
<span class='z'>**</span>
<span class='k'>class</span> TryStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.tryStmt<span class='b'>)</span>
  <span class='b'>{</span>
    catches = Catch<span class='b'>[</span>,<span class='b'>]</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>!block.isExit<span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> catches.all |Catch c-&gt;Bool| <span class='b'>{</span> <span class='k'>return</span> c.block.isExit <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>finallyBlock != <span class='k'>null</span> &amp;&amp; finallyBlock.isDefiniteAssign<span class='b'>(</span>f<span class='b'>))</span> <span class='k'>return</span> <span class='k'>true</span>
    <span class='k'>if</span> <span class='b'>(</span>!block.isDefiniteAssign<span class='b'>(</span>f<span class='b'>))</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> catches.all |Catch c-&gt;Bool| <span class='b'>{</span> c.isDefiniteAssign<span class='b'>(</span>f<span class='b'>)</span> <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    block.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
    catches.each |Catch c| <span class='b'>{</span> c.block.walk<span class='b'>(</span>v, depth<span class='b'>)</span> <span class='b'>}</span>
    <span class='k'>if</span> <span class='b'>(</span>finallyBlock != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      v.enterFinally<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
      finallyBlock.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
      v.exitFinally<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"try"</span><span class='b'>)</span>.nl
    block.print<span class='b'>(</span>out<span class='b'>)</span>
    catches.each |Catch c| <span class='b'>{</span> c.print<span class='b'>(</span>out<span class='b'>)</span> <span class='b'>}</span>
    <span class='k'>if</span> <span class='b'>(</span>finallyBlock != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      out.w<span class='b'>(</span><span class='s'>"finally"</span><span class='b'>)</span>.nl
      finallyBlock.print<span class='b'>(</span>out<span class='b'>)</span>
    <span class='b'>}</span>
  <span class='b'>}</span>

  Expr? exception      <span class='y'>// expression which leaves exception on stack</span>
  Block? block         <span class='y'>// body of try block</span>
  Catch<span class='b'>[]</span> catches      <span class='y'>// list of catch clauses</span>
  Block? finallyBlock  <span class='y'>// body of finally block or null</span>
<span class='b'>}</span>

<span class='z'>**</span>
<span class='z'>** Catch models a single catch clause of a TryStmt</span>
<span class='z'>**</span>
<span class='k'>class</span> Catch : Node
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc<span class='b'>)</span>
  <span class='b'>{</span>
  <span class='b'>}</span>

  Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>block.stmts.last?.id === StmtId.throwStmt<span class='b'>)</span> <span class='k'>return</span> <span class='k'>true</span>
    <span class='k'>return</span> block.isDefiniteAssign<span class='b'>(</span>f<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"catch"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>errType != <span class='k'>null</span><span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>"($errType $errVariable)"</span><span class='b'>)</span>
    out.nl
    block.print<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>

  TypeRef? errType     <span class='y'>// Err type to catch or null for catch-all</span>
  Str? errVariable     <span class='y'>// name of err local variable</span>
  Block? block         <span class='y'>// body of catch block</span>
  Int start            <span class='y'>// start offset generated in CodeAsm</span>
  Int end              <span class='y'>// end offset generated in CodeAsm</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** SwitchStmt</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** SwitchStmt models a switch and its case and default block</span>
<span class='z'>**</span>
<span class='k'>class</span> SwitchStmt : Stmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>Loc loc, Expr condition<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc, StmtId.switchStmt<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.condition = condition
    <span class='k'>this</span>.cases = Case<span class='b'>[</span>,<span class='b'>]</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isDefiniteAssign<span class='b'>(</span>|Expr lhs-&gt;Bool| f<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>defaultBlock == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>if</span> <span class='b'>(</span>!defaultBlock.isDefiniteAssign<span class='b'>(</span>f<span class='b'>))</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> cases.all |Case c-&gt;Bool| <span class='b'>{</span> <span class='k'>return</span> c.block.isDefiniteAssign<span class='b'>(</span>f<span class='b'>)</span> <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Bool isExit<span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>defaultBlock == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>if</span> <span class='b'>(</span>!defaultBlock.isExit<span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> cases.all |Case c-&gt;Bool| <span class='b'>{</span> <span class='k'>return</span> c.block.isExit <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void walkChildren<span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    condition = walkExpr<span class='b'>(</span>v, depth, condition<span class='b'>)</span>
    cases.each |Case c| <span class='b'>{</span> c.walk<span class='b'>(</span>v, depth<span class='b'>)</span> <span class='b'>}</span>
    <span class='k'>if</span> <span class='b'>(</span>defaultBlock != <span class='k'>null</span><span class='b'>)</span> defaultBlock.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void print<span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"switch ($condition)"</span><span class='b'>)</span>.nl
    out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
    out.indent
    cases.each |Case c| <span class='b'>{</span> c.print<span class='b'>(</span>out<span class='b'>)</span> <span class='b'>}</span>
    <span class='k'>if</span> <span class='b'>(</span>defaultBlock != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      out.w<span class='b'>(</span><span class='s'>"default:"</span><span class='b'>)</span>.nl
      out.indent
      defaultBlock.printOpt<span class='b'>(</span>out, <span class='k'>false</span><span class='b'>)</span>
      out.unindent
    <span class='b'>}</span>
    out.unindent
    out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>

  Expr condition        <span class='y'>// test expression</span>
  Case<span class='b'>[]</span> cases          <span class='y'>// list of case blocks</span>
  Block? defaultBlock   <span class='y'>// default block (or null)</span>
  Bool isTableswitch    <span class='y'>// just for testing</span>
<span class='b'>}</span>

<span class='z'>**</span>
<span class='z'>** Case models a single case block of a SwitchStmt</span>
<span class='z'>**</span>
<span class='k'>class</span> Case : Node
<span class='b'>{</span>
  <span class='k'>new</span> <span id='make'>make</span><span class='b'>(</span>Loc loc<span class='b'>)</span>
    : <span class='k'>super</span><span class='b'>(</span>loc<span class='b'>)</span>
  <span class='b'>{</span>
    cases = Expr<span class='b'>[</span>,<span class='b'>]</span>
  <span class='b'>}</span>

  Void <span id='walk'>walk</span><span class='b'>(</span>Visitor v, VisitDepth depth<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>depth === VisitDepth.expr<span class='b'>)</span>
      cases = Expr.walkExprs<span class='b'>(</span>v, cases<span class='b'>)</span>

    block.walk<span class='b'>(</span>v, depth<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void <span id='print'>print</span><span class='b'>(</span>AstWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    cases.each |Expr c| <span class='b'>{</span> out.w<span class='b'>(</span><span class='s'>"case $c:"</span><span class='b'>)</span>.nl <span class='b'>}</span>
    out.indent
    <span class='k'>if</span> <span class='b'>(</span>block != <span class='k'>null</span><span class='b'>)</span> block.printOpt<span class='b'>(</span>out, <span class='k'>false</span><span class='b'>)</span>
    out.unindent
  <span class='b'>}</span>

  Expr<span class='b'>[]</span> <span id='cases'>cases</span>     <span class='y'>// list of case target (literal expressions)</span>
  Block? <span id='block'>block</span>     <span class='y'>// code to run for case</span>
  Int <span id='startOffset'>startOffset</span>  <span class='y'>// start offset for CodeAsm</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** StmtId</span>
<span class='z'>**************************************************************************</span>

<span class='k'>enum</span> <span class='k'>class</span> StmtId
<span class='b'>{</span>
  nop,
  expr,
  localDef,
  ifStmt,
  returnStmt,
  throwStmt,
  forStmt,
  whileStmt,
  breakStmt,
  continueStmt,
  tryStmt,
  switchStmt
<span class='b'>}</span></pre>
</div>
</div>
<div class='sidebar'>
<h2>More Info</h2>
<ul class='clean'>
  <li><a href='Case.html'>View Fandoc</a></li>
</ul>
<div class='slots'>
<div class='overview'>
<h2>Slots</h2>
<ul class='clean'>
  <li style='display: block;'><a href='#block'>block</a></li>
  <li style='display: block;'><a href='#cases'>cases</a></li>
  <li style='display: block;'><a href='#make'>make</a></li>
  <li style='display: block;'><a href='#print'>print</a></li>
  <li style='display: block;'><a href='#startOffset'>startOffset</a></li>
  <li style='display: block;'><a href='#walk'>walk</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
compiler 1.0.56
[11-Nov-2010 Thu 10:08:17AM EST]
</p>
</div>
</div>
</body>
</html>
